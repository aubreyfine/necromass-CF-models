# Trait Variation and Structural Bias in Conversion Factor Models of Soil Microbial Necromass Carbon

_Aubrey K. Fine, Fernanda Santos, Larry M. York_  
Environmental Sciences Division & Biosciences Division, Oak Ridge National Laboratory

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)
[![CC BY 4.0](https://img.shields.io/badge/Data%20License-CC%20BY%204.0-blue.svg)](LICENSE-DATA)
[![Reproducibility: renv](https://img.shields.io/badge/reproducibility-renv-blue)](https://rstudio.github.io/renv/)
![R >= 4.3](https://img.shields.io/badge/R-%3E%3D4.3-blue)
![Python 3.11](https://img.shields.io/badge/Python-3.11-blue)
[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.16905679.svg)](https://doi.org/10.5281/zenodo.16905679)
![CI](https://github.com/<your-username>/<your-repo>/actions/workflows/ci.yml/badge.svg)

## ğŸ”¬ Overview

This repository contains code, data, and figures for the manuscript:

> **Trait Variation and Structural Bias in Conversion-Factor Models of Soil Microbial Necromass Carbon**  
> Submitted to *Soil Biology & Biochemistry* (202X)

We evaluate the assumptions and uncertainty surrounding fixed conversion factors (CFs) used to estimate microbial necromass carbon from amino sugar biomarkers, muramic acid (MurA) and glucosamine (GlcN). The analysis combines:

- taxonomic variation in MurA and GlcN concentrations,  
- CF-based necromass models versus a direct carbonâ€“mass approach, and  
- global sensitivity analysis (Sobol) to identify key drivers of uncertainty in the necromass fraction of SOC (*f<sub>necC</sub>*).

---

## ğŸ“ Repository Structure

- `analysis/`: R and Python scripts and figure generation.
- `data/`: raw, processed, and derived datasets (+ metadata).
- `manuscript/`: manuscript text, journal figures, submission files.
- `supplement/`: supplementary figures and tables, plus a methods README mapping scripts â†’ output.
- `env/`: renv lock + conda environment. 
- `github/`: CI workflows.
---

## ğŸ“¦ Software Requirements

### R

Analyses are written for **R â‰¥ 4.3**. Core packages include (but are not limited to):

- `tidyverse`
- `mgcv`
- `ggridges`
- `gratia`
- `patchwork`
- `forcats`
- `here`
- `lhs`, `boot`, `rstatix` (for uncertainty and statistics)

To install them:
```r
source("install_packages.R")
```

We recommend using `renv` for reproducible environments:
```r
install.packages("renv")  # if needed
renv::restore()
```

---

### Python

Sensitivity-analysis utilities use a minimal Python environment defined in: 

```python
- env/environment.yml
```
Create it with: 

```python
conda env create -f env/environment.yml
conda activate necromass-cf
```

## ğŸ“Š Figures and Tables

- **Main figures:** 1-7
- **Supplementary figures:** S1-S11
- **Tables:** 1-2 and S1-S9

Script-to-output mapping is documented in: 
```
supplement/methods/README.txt
```

---

## ğŸ§ª Reproducibility

To reproduce the key findings and figures:

1. Clone this repository
    ```
    git clone https://github.com/<your-username>/necromass-cf-paper.git
    cd necromass-cf-paper
    ```
2. Run R setup
This loads packages, sets theme defaults, and checks environment:
```r
Rscript analysis/R/01_setup.R
```
3. Generate individual figures

Each script is self-contained and writes:

-preview panels â†’ analysis/figures/

-publication-ready panels â†’ manuscript/figures/

```
Rscript analysis/R/06_Figure2_TraitDistributions.R
Rscript analysis/R/07_Figure3_SobolIndices.R
Rscript analysis/R/07_Figure4_Traits_vs_CF_v2.R
Rscript analysis/R/08_Figure5_Diagnostics.R
Rscript analysis/R/09_Figure6_ModelComparisons_v2.R
Rscript analysis/R/10_Figure7_Feasibility.R
```
---

4. Build all figures at once

```
make figs
```

---

## ğŸ“‚ Data Availability
- All datasets used in this study (amino sugar trait compilations and soil observations) are deposited on Zenodo and publically available:
  https://doi.org/10.5281/zenodo.16905679
- Processed datasets and derived outputs generated by the analysis scripts are stored under the data/processed and data/derived directories.
- No proprietary, confidential, or restricted data were used.

---

## ğŸ“œ License

- **Code:** MIT License (see [`LICENSE`](LICENSE))
- **Data:** CC BY 4.0 (see [`LICENSE-DATA`](LICENSE-DATA))

---

## ğŸ”— Citation

Please cite the following if you use this repository:

> Fine, A.K., Santos, F., York, L. (202X). *Trait Variation and Structural Bias in Conversion Factor Models of Soil Microbial Necromass Carbon*. Submitted to *Soil Biology and Biochemistry*.  
> DOI: https://doi.org/10.5281/zenodo.16905679

A machine-readable citation file is included in [`CITATION.cff`](CITATION.cff).

---

## ğŸ“« Contact
For questions, please contact:
ğŸ“§ Dr. Aubrey K. Fine â€” fineaubrey@gmail.com

---





