# Trait Variation and Structural Bias in Conversion-Factor Models of Soil Microbial Necromass Carbon

_Aubrey K. Fine, Fernanda Santos, Larry M. York_  
Environmental Sciences Division & Biosciences Division, Oak Ridge National Laboratory

[![License: MIT](https://img.shields.io/badge/Code%20License-MIT-yellow.svg)](LICENSE)
[![Data License: CC-BY 4.0](https://img.shields.io/badge/Data%20License-CC--BY%204.0-lightgrey.svg)](LICENSE-DATA)
[![Reproducibility: renv](https://img.shields.io/badge/reproducibility-renv-blue)](https://rstudio.github.io/renv/)
![R >= 4.3](https://img.shields.io/badge/R-%3E%3D4.3-blue)
![Python 3.11](https://img.shields.io/badge/Python-3.11-blue)
[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.16905679.svg)](https://doi.org/10.5281/zenodo.16905679)

---

## ğŸ”¬ Overview

This repository contains code, data, and figures for the manuscript:

> **Trait Variation and Structural Bias in Conversion-Factor Models of Soil Microbial Necromass Carbon**  
> Submitted to *Soil Biology & Biochemistry* (202X)

We evaluate the assumptions and uncertainty surrounding fixed conversion factors (CFs) used to estimate microbial necromass carbon from amino sugar biomarkers, muramic acid (MurA) and glucosamine (GlcN). The analysis combines:

- taxonomic variation in MurA and GlcN concentrations,  
- CF-based necromass models versus a direct carbonâ€“mass approach, and  
- global sensitivity analysis (Sobol) to identify key drivers of uncertainty in the necromass fraction of SOC (*f<sub>necC</sub>*).

---

## ğŸ“ Repository Structure

- `analysis/`: R and Python scripts and figure generation.
- `data/`: raw, processed, and derived datasets (+ metadata).
- `manuscript/`: manuscript text, journal figures, submission files.
- `supplement/`: supplementary figures and tables, plus a methods README mapping scripts â†’ output.
- `env/`: R renv lockfile + Python conda environment. 
- `.github/`: CI workflows (GitHub Actions).
- 
---

## ğŸ“¦ Software Requirements

### R

Analyses are written for **R â‰¥ 4.3**. Core packages include (but are not limited to):

- `tidyverse`
- `mgcv`
- `ggridges`
- `gratia`
- `patchwork`
- `forcats`
- `here`
- `lhs`, `boot`, `rstatix` (for uncertainty and statistics)

To install them:
```r
source("install_packages.R")
```

We recommend using `renv` for reproducible environments:
```r
install.packages("renv")  # if needed
renv::restore()
```

---

### Python

Global sensitivity analyses and necromass-CF diagnostics use a minimal Python environment defined in:

```bash
env/environment.yml
```

Create and activate it with:

```bash
conda env create -f env/environment.yml
conda activate necromass-cf
```

Key Python scripts are located in `analysis/Python/`:

- `model_definitions.py` â€” data loading, trait distributions, and CF / fnecC model functions

- `gsa_numeric.py` â€” Sobol, Delta, and Morris analyses; writes tidy CSVs to `data/derived/gsa/`

- `rb_significance.py` â€” rB sensitivity, Î”N_F, Î”f_necC, truncation, and R distributions

- `run_all_gsa.py` â€” convenience driver that runs all of the above in sequence

To run all global sensitivity and rB analyses in one step:

```
python analysis/Python/run_all_gsa.py

```

Numeric outputs are written to `data/derived/gsa/` and are consumed by the R scripts that generate figures.

---

## ğŸ§ª Reproducibility

1. Clone this repository and set your working directory

```python
git clone https://github.com/<your-username>/necromass-cf-paper.git
cd necromass-cf-paper
```

or in R:
    
```R
    setwd("path/to/necromass-cf-paper")
```
    
2. Run R setup
   
This loads packages, sets theme defaults, and checks environment:

```bash
Rscript analysis/R/01_setup.R
```

3. Generate main figures (Figures 2-7)

   Each script:
   - reads required data from `data/`
   - generates figure panels
   - writes outputs to:
     - `analysis/figures/` (PNG preview)
     - `manuscript/figures/` (PDF publication version)

```
# Figure 2
Rscript analysis/R/05_Figure2_TraitDistributions.R

# Figure 3
Rscript analysis/R/06_Figure3_SobolIndices.R

# Figure 4
Rscript analysis/R/07_Figure4_Traits_vs_CF_v2.R

# Figure 5
Rscript analysis/R/08_Figure5_Diagnostics.R

# Figure 6
Rscript analysis/R/09_Figure6_ModelComparisons_v2.R

# Figure 7
Rscript analysis/R/10_Figure7_Feasibility.R

```

---

**Optional: generate all figures at once**
If you have ['make'](make) installed: 

```bash
make figs
```

Otherwise, run each script individually (above). 

---

## ğŸ“Š Figures and Tables

- **Main figures:** 1-7
- **Supplementary figures:** S1-S11
- **Tables:** 1-2 and S1-S9

Script-to-output mapping is documented in: 
'supplement/methods/README.txt'.

---

## ğŸ“‚ Data Availability
- All datasets used in this study (amino sugar trait compilations and soil observations) are deposited on Zenodo and publically available:
  https://doi.org/10.5281/zenodo.16905679
- Processed datasets and derived outputs generated by the analysis scripts are stored under the 'data/processed/' and 'data/derived/' directories.
- No proprietary, confidential, or restricted data were used.

---

## ğŸ“œ License

- **Code:** MIT License (see [`LICENSE`](LICENSE))
- **Data:** CC BY 4.0 (see [`LICENSE-DATA`](LICENSE-DATA))

---

## ğŸ”— Citation

Please cite the following if you use this repository:

> Fine, A.K., Santos, F., York, L. (202X). *Trait Variation and Structural Bias in Conversion Factor Models of Soil Microbial Necromass Carbon*. Submitted to *Soil Biology and Biochemistry*.  
> DOI: https://doi.org/10.5281/zenodo.16905679

A machine-readable citation file is included in [`CITATION.cff`](CITATION.cff).

---

## ğŸ“« Contact
For questions, please contact:
ğŸ“§ Dr. Aubrey K. Fine â€” fineaubrey@gmail.com

---





